<source>
    @type syslog
    port 5140
    bind 0.0.0.0
    tag authpriv
</source>

<filter authpriv.auth.info>
    @type grep
    <regexp>
        key ident
        pattern /sshd.*/
    </regexp>
    <regexp>
        key message
        pattern /(Success|Fail)\,/
    </regexp>
</filter>

<filter authpriv.auth.info>
    @type parser
    key_name message
    <parse>
        @type regexp
        expression /(?<csv>.*)\s/
    </parse>
</filter>

<filter authpriv.auth.info>
    @type parser
    key_name csv
    <parse>
        @type csv
        keys result,user,ip,authtime,detect,rtt,year,month,day,hour,minute,second,usecond,kex,newkey
    </parse>
</filter>

<filter authpriv.auth.info>
    @type record_transformer
    <record>
        server_id "bitris.*.ssh"
    </record>
</filter>

<match authpriv.auth.info>
    @type copy
    # send to log server
    <store>
        @type forward
        send_timeout 30s
        recover_wait 10s
        <server>
            name bitris-log-server
            host 10.1.228.31
            port 24224
        </server>        
    </store>    
    # local backup
    <store>
        @type file
        path /var/log/fluent/bitris
        compress gzip
        <buffer>
            timekey 1d
            timekey_wait 1m
        </buffer>
    </store>
</match>